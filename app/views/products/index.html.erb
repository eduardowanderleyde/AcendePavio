<div class="row">
  <div class="col-md-3">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Filtros</h5>
      </div>
      <div class="card-body">
        <%= form_tag products_path, method: :get, class: 'filter-form' do %>
          <div class="mb-3">
            <label class="form-label">Categorias</label>
            <% Category.all.each do |category| %>
              <div class="form-check">
                <%= check_box_tag "categories[]", category.id, params[:categories]&.include?(category.id.to_s), class: 'form-check-input' %>
                <%= label_tag "categories_#{category.id}", category.name, class: 'form-check-label' %>
              </div>
            <% end %>
          </div>

          <div class="mb-3">
            <label class="form-label">Preço</label>
            <div class="input-group mb-2">
              <%= number_field_tag :min_price, params[:min_price], class: 'form-control', placeholder: 'Mín' %>
              <span class="input-group-text">-</span>
              <%= number_field_tag :max_price, params[:max_price], class: 'form-control', placeholder: 'Máx' %>
            </div>
          </div>

          <%= submit_tag 'Filtrar', class: 'btn btn-primary w-100' %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="col-md-9">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Nossos Produtos</h2>
      <div class="dropdown">
        <%= select_tag :sort, 
            options_for_select([
              ['Mais Recentes', 'newest'],
              ['Menor Preço', 'price_asc'],
              ['Maior Preço', 'price_desc']
            ], params[:sort]),
            class: 'form-select',
            onchange: 'this.form.submit()',
            prompt: 'Ordenar por...' %>
      </div>
    </div>

    <div class="row row-cols-1 row-cols-md-3 g-4">
      <% @products.each do |product| %>
        <div class="col">
          <div class="card h-100">
            <% if product.images.attached? %>
              <%= image_tag product.main_image, class: "card-img-top product-image" %>
            <% end %>
            <div class="card-body">
              <h5 class="card-title"><%= product.name %></h5>
              <p class="card-text text-muted"><%= truncate(product.description, length: 100) %></p>
              <div class="d-flex justify-content-between align-items-center">
                <span class="h5 mb-0"><%= number_to_currency(product.price) %></span>
                <%= link_to 'Ver Detalhes', product_path(product), class: 'btn btn-outline-primary' %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <div class="d-flex justify-content-center mt-4">
      <%= paginate @products if @products.respond_to?(:total_pages) %>
    </div>
  </div>
</div>
